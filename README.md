# Алгоритм приведения членов сложных пропорций к целевым значениям

<br>

## Основные термины

### Сложная пропорция
Соотношение произвольных значений двух или более однородных величин.  
Пример сложной пропорции из трех величин:  
```
7:3:10
```

### Члены сложной пропорции
Элементы, количественную взаимосвязь между которыми устанавливает сложная пропорция.  
Пример:  
```
В сложной пропорции 7:3:10 первый член = 7, второй = 3, третий = 10
```

### Сумма членов сложной пропорции
Сумма значений каждого члена сложной пропорции.  
Пример:  
```
Сумма членов сложной пропорции 7:3:10 равна 7+3+10=20
```

### Процентное представление сложной пропорции
Сложная пропорция, члены которой представлены в виде процента от ее суммы.  
Сумма членов процентного представления сложной пропорции всегда равна 100%.  
Пример:  
```
Процентное представление сложной пропорции 7:3:10 — 35%:15%:50%
Сумма членов сложной пропорции = 20, отсюда — (7/20):(3/20):(10/20) — 35%:15%:50%
```

<br>

## Смысл сложной пропорции
Сложная пропорция — это модель «разбиения» некоторого числа (суммы сложной пропорции) в соотношении, заданном членами этой сложной пропорции.  
Пример:  
```
Имеется набор из 20 шаров трех различных цветов — белого (7 шаров), красного (3 шара) и черного (10 шаров).  
Соотношение количества шаров в этом наборе — 7:3:10 или, другими словами, в этом наборе 35% белых шаров, 15% красных и 50% черных.  
```

<br>

## Производные термины

### Целевая сложная пропорция
Сложная пропорция, сумма членов которой равна некоторому заданному значению, «разбитому» в определенном соотношении.  
Целевая сложная пропорция моделирует «эталонное» состояние для сравнимой с ней текущей сложной пропорции.  
Пример:  
```
Имеется набор из 20 шаров — 7 белых, 3 красных и 10 черных.
Текущая сложная пропорция — 7:3:10, или 35% белых : 15% красных : 50% черных.

Целевой набор должен состоять из 54 шаров — 18 белых, 12 красных и 24 черных.
Целевая сложная пропорция — 18:12:24, или 33,3% белых : 22,2% красных : 44,4% черных.
```

### Отличие текущей сложной пропорции от целевой
Последовательность значений, вычисляемых как разность между текущим значением члена сложной пропорции и его же целевым значением.  
Обе сложные пропорции — текущая и целевая — должны быть представлены в процентном виде.  
Пример:  
```
Целевая сложная пропорция  — 33,3% : 22,2% : 44,4%  
Текущая сложная пропорция  — 35.0% : 15.0% : 50.0%  
Отличие текущей от целевой — -1.7% : +7.2% : -5.6%  

На примере с шарами, в текущем наборе против целевых значений имеется:  
- избыток белых шаров (лишние 1.7%)  
- недостаток красных шаров (недостающие 7.2%)  
- избыток черных шаров (лишние 5.6%)  
```

### Приведение к целевому значению
Изменение текущих значений членов сложной пропорции с целью минимизации их отличий от целевых значений, выполняемое за конечное число шагов.  
За один шаг производится изменение только одного из членов сложной пропорции, каждый раз на одну и ту же величину (шаг изменения).  
Пример №1, с пошаговым приращением:  
```
Имеется набор из 20 шаров — 7 белых, 3 красных и 10 черных.
Текущая сложная пропорция — 7:3:10, или 35% белых : 15% красных : 50% черных.

Целевой набор должен состоять из 54 шаров — 18 белых, 12 красных и 24 черных.
Целевая сложная пропорция — 18:12:24, или 33,3% белых : 22,2% красных : 44,4% черных.

Приведение текущей сложной пропорции к целевой осуществляется путем последовательного добавления к текущему набору (20 шаров) по одному шару (шаг изменения) такого цвета, чтобы общее количество шаров на любом шаге не превышало целевого (54 шара), а их итоговое соотношение было как можно ближе к целевому распределению (33.3% белых : 22.2% красных : 44.4% черных).
```

Пример №2, с пошаговым уменьшением:  
```
Имеется набор из 54 шаров — 18 белых, 12 красных и 24 черных.
Текущая сложная пропорция — 18:12:24, или 33,3% белых : 22,2% красных : 44,4% черных.  

Целевой набор должен состоять из 20 шаров — 7 белых, 3 красных и 10 черных.
Целевая сложная пропорция — 7:3:10, или 35% белых : 15% красных : 50% черных.

Приведение текущей сложной пропорции к целевой осуществляется путем последовательного изъятия из текущего набора (54 шара) по одному шару (шаг изменения) такого цвета, чтобы общее количество шаров на любом шаге было не меньше целевого (20 шаров), а их итоговое соотношение было как можно ближе к целевому распределению (35% белых : 15% красных : 50% черных).
```

<br>

## Задача алгоритма
Пример:  
```
Имеется набор из 20 шаров — 7 белых, 3 красных и 10 черных.
Текущая сложная пропорция — 7:3:10, или 35% белых : 15% красных : 50% черных.

Целевой набор должен состоять из 54 шаров — 18 белых, 12 красных и 24 черных.
Целевая сложная пропорция — 18:12:24, или 33,3% белых : 22,2% красных : 44,4% черных.  

Задача алгоритма:  
1. Проверить возможность запуска очередного цикла изменения текущей сложной пропорции.  
2. Если запуск возможен, определить, добавление шара какого именно цвета (белого, красного или черного) приведет текущую пропорцию к целевой наилучшим образом.  
3. Изменить текущую пропорцию соответствующим образом.  
4. Вернуться к началу алгоритма, либо завершить его с возвратом текущей пропорции, приведенной к целевой.  
```


<br>

## Вход алгоритма
1. Текущая сложная пропорция в естественных единицах.  
2. Сумма членов целевой пропорции.  
3. Целевая пропорция в процентном виде.  
4. Шаг изменения.  


<br>

## Выход алгоритма

1. Текущая сложная пропорция, приведенная к целевой наилучшим образом.  




<br>

## Порядок выполнения
```
1. Определить направление изменения для членов пропорции:  
   a. Если заданный на входе шаг изменения больше 0, вернуть true и перейти к п. 2 алгоритма.  
   b. Если заданный на входе шаг изменения меньше 0, вернуть false и перейти к п. 2 алгоритма.  
   c. Завершить алгоритм переходом к п. 12, если заданный на входе шаг изменения равен 0.  
2. Проверить возможность запуска очередного цикла выполнения алгоритма:  
   a. Определить сумму членов текущей пропорции в естественных единицах.  
   b. Если п. 1 алгоритма вернул true И текущая сумма, полученная в п. 2a + шаг изменения меньше или равно сумме членов целевой пропорции, перейти к п. 3 алгоритма.  
   c. Если п. 1 алгоритма вернул false И текущая сумма, полученная в п. 2a + шаг изменения больше или равно сумме членов целевой пропорции, перейти к п. 3 алгоритма.  
   d. Завершить алгоритм переходом к п. 12, если не выполнено ни одно из условий п.п. 2b или 2c.  
3. Представить текущую пропорцию в процентном виде.  
4. Вычислить отличие текущей пропорции от целевой, в процентном виде.  
5. Вычислить стандартное отклонение для полученной совокупности значений.  
6. Для каждого члена текущей пропорции рассчитать вариант его изменения:  
   a. Изменить значение на шаг изменения.  
   b. Представить полученный новый вариант текущей пропорции в процентном виде.  
   c. Вычислить отличие полученной в п. 6b пропорции от целевой, в процентном виде.  
   d. Вычислить стандартное отклонение для полученной в п. 6c совокупности значений.  
   e. Сохранить полученное в п. 6d значение, сопоставленное с порядковым номером члена пропорции, во временном списке.  
7. Отсортировать временный список, сформированный в п. 6e, по возрастанию стандартного отклонения.  
8. Выбрать первый элемент временного списка, отсортированного в п. 7.  
9. Выбрать порядковый номер члена пропорции, сопоставленный с полученным в п. 8 стандартным отклонением.  
10. Изменить выбранный в п. 9 алгоритма член сложной пропорции, суммируя его текущее значение с заданным на входе шагом изменения.  
11. Вернуться к п. 2 алгоритма.  
12. Завершить алгоритм, вернув текущую сложную пропорцию.  
```